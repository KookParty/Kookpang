#key=query
#user
user.select=select * from users order by created_at desc

#paging
page.limitOffset=limit ? offset ?

#product
product.selectAll=select * from products order by created_at desc
product.countAll=select count(*) from products
product.selectByOptions1=select * from products where category=? and name like ? order by price
product.countByOptions1=select count(*) from products where category=? and name like ?
product.selectByOptions2=select * from products where name like ? order by price
product.countByOptions2=select count(*) from products where name like ?
product.insertProduct=insert into products(name, price, description, category, brand, image_url) values (?, ?, ?, ?, ?, ?)
product.updateProduct=update products set name=?, price=?, description=?, category=?, brand=?, image_url=? where product_id=?
product.deleteProduct=delete from products where product_id=?
product.selectCategory=select distinct category from products order by category
product.selectByProductId=select * from products where product_id=?
#cart
cart.selectByUserId=select * from carts where user_id=?
cart.selectByUserIdAndProductId = select * from carts where user_id=? and product_id=?
cart.insertCart=insert into carts(user_id, product_id) values(?, ?)
cart.countCart=select count(*) from carts where user_id=?
cart.deleteCartByCartId=delete from carts where cart_id=? and user_id=?
cart.deleteCartByUserId=delete from carts where user_id=?
cart.updateCartCount=update carts set count=? where cart_id=? and user_id=?
#order
order.selectByUserId=select * from orders where user_id=? order by created_at desc
order.selectByUserIdLimit=select * from orders where user_id=? order by created_at desc limit 3 offset 0
order.selectByOrderId=select * from orders where order_id=?
order.selectItemsByOrderId=select * from orders_items where order_id=?
order.insertOrder=insert into orders(user_id, total_price, delivery_fee, shipping_address, order_name, cid, tid, partner_order_id, partner_user_id, pg_token) values(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
order.insertOrderItem=insert into orders_items(order_id, product_id, count, price) values(?, ?, ?, ?)
order.deleteOrder=update orders set status=0 where order_id=?
 
#recipe
recipe.selectByOptions=select r.* from recipes r
recipe.selectByLike=select r.*, count(l.user_id) as like_cnt from recipes r left join likes l on l.target_type='RECIPE' and l.target_id=r.recipe_id 
recipe.selectById=select * from recipes where recipe_id = ?
recipe.selectVariantsByParentId=select * from recipes where parent_recipe_id = ?
recipe.insertRecipe=insert into recipes(user_id, title, description, thumbnail_url, recipe_type, way, category, parent_recipe_id, created_at) values(?, ?, ?, ?, ?, ?, ?, ?, now());
recipe.deleteRecipeByRecipeId=delete from recipes where recipe_id = ?
recipe.count=select count(*) from recipes

#ingredient
ingredient.selectByRecipeId=select i.*, p.price as price, case when p.category = '\uC870\uBBF8\uB8CC' then 1 else 0 end as is_seasoning from ingredients i left join products p on i.product_id = p.product_id where recipe_id = ? order by (i.product_id is not null and i.product_id != 0) desc;
ingredient.insertIngredients=insert into ingredients(recipe_id, name, quantity, product_id) values(?, ?, ?, ?)

#step
step.selectByRecipeId=select * from steps where recipe_id = ? order by step_order
step.insertSteps=insert into steps(recipe_id, step_order, description, image_url) values(?, ?, ?, ?)

#review
review.selectByRecipeId=select r.*, u.nickname as nickname from reviews r left join users u on r.user_id = u.user_id where recipe_id = ? order by created_at desc
review.insertReview=insert into reviews(recipe_id, user_id, rating, content, image_url) values(?, ?, ?, ?, ?)
review.deleteReview=delete from reviews where review_id = ?

#like
like.selectLikeCnt=select count(*) from likes where target_type = ? and target_id = ?
like.isLiked=select * from likes where user_id = ? and target_type = ? and target_id = ?
like.insertLike=insert into likes(user_id, target_type, target_id) values(?, ?, ?)
like.deleteLike=delete from likes where user_id = ? and target_type = ? and target_id = ?

# =========== Board ===========
board.post.insert=INSERT INTO posts (user_id, category, title, content) VALUES (?, ?, ?, ?)

board.post.update=UPDATE posts SET category = ?, title = ?, content = ? WHERE post_id = ? AND user_id = ?

board.post.delete=DELETE FROM posts WHERE post_id = ? AND user_id = ?

board.post.incView=UPDATE posts SET view_count = view_count + 1 WHERE post_id = ?

board.post.findById=SELECT p.post_id, p.user_id, p.category, p.title, p.content, p.view_count, p.comment_count, p.created_at, u.nickname FROM posts p JOIN users u ON u.user_id = p.user_id WHERE p.post_id = ?

# \uBAA9\uB85D/\uAC80\uC0C9: (1:catAsStr, 2:cat, 3:q, 4:q, 5:q, 6:size, 7:off)
board.post.listPage=SELECT p.post_id, p.title, p.content, p.view_count, p.comment_count, p.created_at, u.nickname, p.category FROM posts p JOIN users u ON u.user_id = p.user_id WHERE ( ? = '' OR p.category = ? ) AND ( ? = '' OR p.title LIKE CONCAT('%', ?, '%') OR p.content LIKE CONCAT('%', ?, '%') ) ORDER BY p.created_at DESC LIMIT ? OFFSET ?

# \uCE74\uC6B4\uD2B8: (1:catAsStr, 2:cat, 3:q, 4:q, 5:q)
board.post.count=SELECT COUNT(*) FROM posts p WHERE ( ? = '' OR p.category = ? ) AND ( ? = '' OR p.title LIKE CONCAT('%', ?, '%') OR p.content LIKE CONCAT('%', ?, '%') )

# \uC774\uBBF8\uC9C0
board.image.insert=INSERT INTO post_images (post_id, image_url, image_order) VALUES (?, ?, ?)
board.image.deleteByPost=DELETE FROM post_images WHERE post_id = ?
board.image.list=SELECT image_id, post_id, image_url, image_order FROM post_images WHERE post_id = ? ORDER BY image_order ASC, image_id ASC

# \uB313\uAE00
board.comment.list=SELECT c.comment_id, c.post_id, c.user_id, c.content, c.created_at, u.nickname FROM comments c JOIN users u ON u.user_id = c.user_id WHERE c.post_id = ? ORDER BY c.comment_id ASC

board.comment.insert=INSERT INTO comments (post_id, user_id, content) VALUES (?, ?, ?)
board.comment.incOnAdd=UPDATE posts SET comment_count = comment_count + 1 WHERE post_id = ?
board.comment.delete=DELETE FROM comments WHERE comment_id = ? AND user_id = ?
board.comment.decOnDel=UPDATE posts SET comment_count = comment_count - 1 WHERE post_id = ?



